# Copilot App - AI Бизнес-Ассистент

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![Python](https://img.shields.io/badge/Python-3.11-3776ab.svg)
![React](https://img.shields.io/badge/React-18.2.0-61dafb.svg)
![TypeScript](https://img.shields.io/badge/TypeScript-5.2.2-3178c6.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.121.1-009688.svg)

**AI-ассистент для бизнес-консультаций с интеллектуальной классификацией вопросов**

Веб-приложение для получения консультаций по бизнесу с использованием искусственного интеллекта. Система автоматически классифицирует вопросы по категориям (маркетинг, финансы, юриспруденция, управление, продажи) и предоставляет релевантные ответы.

---

## Оглавление

- [Описание проекта](#описание-проекта)
- [Архитектура системы](#архитектура-системы)
- [Основной функционал](#основной-функционал)
- [Технологический стек](#технологический-стек)
- [Запуск проекта](#запуск-проекта)
- [Конфигурация](#конфигурация)
- [Структура проекта](#структура-проекта)
- [API документация](#api-документация)
- [ML модуль](#ml-модуль)

---

## Описание проекта

Copilot App - это полнофункциональная платформа для бизнес-консультаций, которая объединяет:

- **AI-чат** - интеллектуальный диалог с классификацией вопросов по категориям
- **Рабочие пространства** - организация чатов и заметок по проектам
- **Заметки** - создание и управление бизнес-заметками
- **Универсальный поиск** - поиск по чатам, заметкам и сообщениям
- **Система поддержки** - обратная связь и справочные статьи
- **Настройки уведомлений** - управление уведомлениями по пространствам

### Ключевые возможности

- Автоматическая классификация бизнес-вопросов с помощью ML
- Контекстные ответы на основе истории диалога
- Организация работы через пространства
- Markdown-поддержка в ответах ассистента
- Экспорт пространств в ZIP-архивы
- Многоязычный интерфейс (русский/английский)

---

## Архитектура системы

Проект состоит из следующих компонентов:

```
┌─────────────────────────────────────────────────────────┐
│                    Frontend (React)                     │
│              React 18 + TypeScript + Vite               │
│                    Порт: 3000 (dev)                     │
└──────────────┬──────────────────────────────────────────┘
               │
               │ HTTP/REST API
               │
┌──────────────▼──────────────────────────────────────────┐
│              Backend (FastAPI)                          │
│         FastAPI + SQLAlchemy + PostgreSQL               │
│                    Порт: 8000                           │
│                                                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Routes:                                         │   │
│  │  - /api/auth      - Аутентификация              │   │
│  │  - /api/chat      - Чат с AI                    │   │
│  │  - /api/spaces    - Рабочие пространства         │   │
│  │  - /api/notes     - Заметки                      │   │
│  │  - /api/search    - Универсальный поиск          │   │
│  │  - /api/support   - Поддержка                    │   │
│  └──────────────────────────────────────────────────┘   │
│                                                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Services:                                        │   │
│  │  - LLMService      - Интеграция с OpenRouter      │   │
│  │  - ConversationManager - Управление диалогами    │   │
│  │  - ClassifierService - ML классификация          │   │
│  └──────────────────────────────────────────────────┘   │
└──────────────┬──────────────────────────────────────────┘
               │
               │ SQL
               │
┌──────────────▼──────────────────────────────────────────┐
│              PostgreSQL Database                         │
│              Порт: 5431 (host) / 5432 (container)        │
└──────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│              ML Module (Machine Learning)                │
│         RandomForestClassifier + scikit-learn            │
│                                                           │
│  - Классификация вопросов по 6 категориям                │
│  - Обучение на датасете из 600 примеров                  │
│  - Извлечение признаков из текста                        │
└──────────────────────────────────────────────────────────┘
```

### Компоненты:

1. **Frontend** - React-приложение с TypeScript для веб-интерфейса
2. **Backend** - FastAPI сервер для REST API
3. **PostgreSQL** - Реляционная база данных
4. **ML Module** - Модуль машинного обучения для классификации
5. **OpenRouter** - Интеграция с LLM через OpenRouter API

---

## Основной функционал

### AI-Чат

- **Интеллектуальный диалог**
  - Отправка вопросов AI-ассистенту
  - Получение контекстных ответов с учетом истории
  - Поддержка Markdown в ответах
  - Индикатор "Поиск и формирование ответа"

- **Управление чатами**
  - Создание новых чатов
  - Переименование чатов
  - Удаление чатов
  - История сообщений

- **Классификация вопросов**
  - Автоматическое определение категории вопроса
  - 6 категорий: marketing, finance, legal, management, sales, general
  - Улучшенные промпты на основе категории

### Рабочие пространства

- **Управление пространствами**
  - Создание рабочих пространств
  - Архивация/разархивация пространств
  - Экспорт пространства в ZIP-архив
  - Добавление чатов в пространство

- **Организация контента**
  - Группировка чатов по пространствам
  - Создание заметок в пространствах
  - Просмотр статистики (чаты, заметки, теги)

### Заметки

- **Создание и редактирование**
  - Создание заметок с заголовком и содержимым
  - Редактирование существующих заметок
  - Удаление заметок
  - Привязка заметок к пространствам

- **Теги**
  - Создание тегов для заметок
  - Фильтрация заметок по тегам
  - Цветовая маркировка тегов

### Поиск

- **Универсальный поиск**
  - Поиск по чатам, заметкам и сообщениям
  - Фильтрация по типу контента
  - Подсветка найденных фрагментов
  - Навигация к найденным элементам

### Поддержка

- **Обратная связь**
  - Отправка обращений в поддержку
  - Разные формы для авторизованных/неавторизованных пользователей
  - Категории обращений (bug, feature, question, other)

- **Справочные статьи**
  - Просмотр статей поддержки
  - Поиск по статьям
  - Модальные окна для чтения

### Настройки

- **Уведомления**
  - Настройка уведомлений по пространствам
  - Управление типами уведомлений (новые сообщения, заметки, файлы)

- **Профиль**
  - Редактирование профиля
  - Смена языка интерфейса
  - Выход из системы

---

## Технологический стек

### Frontend

- **React 18.2.0** - UI библиотека
- **TypeScript 5.2.2** - типизация
- **Vite 5.0.8** - сборщик и dev-сервер
- **react-markdown 10.1.0** - рендеринг Markdown
- **remark-gfm** - поддержка GitHub Flavored Markdown
- **@hugeicons/react** - библиотека иконок

### Backend

- **FastAPI 0.121.1** - веб-фреймворк
- **SQLAlchemy 2.0.23** - ORM
- **PostgreSQL 15** - база данных
- **psycopg2-binary** - драйвер PostgreSQL
- **python-jose** - JWT токены
- **openai** - клиент для OpenRouter API
- **tiktoken** - подсчет токенов

### Machine Learning

- **scikit-learn 1.7.2** - RandomForestClassifier
- **pandas 2.3.3** - обработка данных
- **numpy 2.2.6** - математические операции
- **joblib 1.5.2** - сохранение моделей

### Инфраструктура

- **Docker** - контейнеризация
- **Docker Compose** - оркестрация сервисов
- **PostgreSQL** - база данных

---

## Запуск проекта

### Предварительные требования

- **Docker** >= 20.10
- **Docker Compose** >= 2.0
- **Python** >= 3.11 (для локальной разработки)
- **Node.js** >= 18.0.0 (для локальной разработки frontend)
- **OpenRouter API Key** - для работы AI-ассистента

### Переменные окружения

Создайте файл `.env` в корне проекта:

```env
# OpenRouter API
OPENROUTER_API_KEY=your_openrouter_api_key_here

# База данных (опционально, есть значения по умолчанию)
POSTGRES_USER=copilot_user
POSTGRES_PASSWORD=copilot_pass
POSTGRES_DB=copilot_db
DATABASE_URL=postgresql://copilot_user:copilot_pass@db:5432/copilot_db

# JWT секреты (опционально)
JWT_SECRET_KEY=your-secret-key-here
JWT_ALGORITHM=HS256
```

### Запуск через Docker Compose

#### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd Copilot_app
```

#### 2. Настройка переменных окружения

Создайте `.env` файл с необходимыми переменными (см. выше).

#### 3. Запуск всех сервисов

```bash
docker compose up --build
```

#### 4. Доступ к сервисам

После запуска сервисы будут доступны:

- **Frontend**: `http://localhost:3000` (если запущен отдельно) или через backend
- **Backend API**: `http://localhost:8000/api`
- **Swagger документация**: `http://localhost:8000/api/docs`
- **ReDoc документация**: `http://localhost:8000/api/redoc`
- **PostgreSQL**: `localhost:5431` (для внешнего доступа)

### Локальная разработка

#### Backend

```bash
cd backend
pip install -r requirements.txt

# Убедитесь, что PostgreSQL запущен
# Создайте .env файл с переменными окружения

# Запуск сервера
python main.py
```

Backend будет доступен на `http://localhost:8000`

#### Frontend

```bash
cd frontend
npm install
npm run dev
```

Frontend будет доступен на `http://localhost:3000`

#### База данных

```bash
# Запуск только PostgreSQL
docker compose up db

# Или используйте локальный PostgreSQL
# Укажите DATABASE_URL в .env
```

### Обучение ML модели

Перед использованием классификатора необходимо обучить модель:

```bash
cd backend/ml
python train_classifier.py
```

Модель будет сохранена в `backend/ml/models/business_classifier.pkl`

---

## Конфигурация

### Docker Compose

Файл `docker-compose.yml` настраивает:

- **PostgreSQL** - база данных на порту 5431
- **Backend** - FastAPI приложение на порту 8000
- **Volumes** - персистентное хранение данных БД
- **Health checks** - проверка работоспособности сервисов

### Backend конфигурация

Основные настройки в `backend/main.py`:

- CORS middleware для работы с frontend
- Подключение роутов с префиксом `/api`
- Статические файлы из `backend/static/`
- Swagger документация на `/api/docs`

### Frontend конфигурация

- **Vite** - конфигурация в `frontend/vite.config.ts`
- **TypeScript** - настройки в `frontend/tsconfig.json`
- **API URL** - настраивается в `frontend/src/utils/api.ts`

---

## Структура проекта

```
Copilot_app/
├── backend/                    # Backend приложение
│   ├── app/                    # Основное приложение
│   │   ├── database/           # Работа с БД
│   │   │   ├── base.py         # Базовые классы
│   │   │   ├── connection.py   # Подключение к БД
│   │   │   ├── init_db.py      # Инициализация БД
│   │   │   └── init.sql        # SQL схема
│   │   ├── models/             # SQLAlchemy модели
│   │   │   ├── user.py         # Пользователь
│   │   │   ├── chat.py         # Чат
│   │   │   ├── message.py      # Сообщение
│   │   │   ├── space.py        # Пространство
│   │   │   ├── note.py         # Заметка
│   │   │   ├── tag.py          # Тег
│   │   │   └── ...
│   │   ├── routes/             # API маршруты
│   │   │   ├── auth_routes.py  # Аутентификация
│   │   │   ├── chat_routes.py  # Чат с AI
│   │   │   ├── spaces_routes.py # Пространства
│   │   │   ├── notes_routes.py # Заметки
│   │   │   ├── search_routes.py # Поиск
│   │   │   └── support_routes.py # Поддержка
│   │   └── services/           # Бизнес-логика
│   │       ├── llm_service.py  # Интеграция с LLM
│   │       ├── conversation_manager.py # Управление диалогами
│   │       ├── classifier_service.py # ML классификация
│   │       └── ...
│   ├── ml/                     # ML модуль
│   │   ├── models/             # Модели ML
│   │   │   ├── business_classifier.py # Классификатор
│   │   │   └── business_classifier.pkl # Обученная модель
│   │   ├── services/           # ML сервисы
│   │   │   └── classifier_service.py
│   │   ├── datasets/           # Датасеты
│   │   │   └── dataset_generation.py
│   │   ├── train_classifier.py # Скрипт обучения
│   │   └── Readme.md           # Документация ML
│   ├── static/                 # Статические файлы
│   ├── main.py                 # Точка входа
│   ├── requirements.txt        # Python зависимости
│   ├── Dockerfile              # Docker образ
│   └── README.md               # Документация backend
│
├── frontend/                   # Frontend приложение
│   ├── src/
│   │   ├── components/          # React компоненты
│   │   │   ├── common/         # Общие компоненты
│   │   │   │   ├── ChatArea/   # Область чата
│   │   │   │   ├── Sidebar/    # Боковая панель
│   │   │   │   ├── Header/     # Шапка
│   │   │   │   ├── SearchPanel/ # Панель поиска
│   │   │   │   ├── NotesPanel/ # Панель заметок
│   │   │   │   └── ...
│   │   │   └── ui/             # UI компоненты
│   │   │       ├── Button/     # Кнопка
│   │   │       ├── Icon/       # Иконка
│   │   │       └── Input/      # Поле ввода
│   │   ├── pages/              # Страницы
│   │   │   ├── AssistantPage/  # Главная страница
│   │   │   ├── LoginPage/      # Вход
│   │   │   ├── RegisterPage/   # Регистрация
│   │   │   ├── SpacesPage/     # Пространства
│   │   │   ├── SpaceDetailPage/ # Детали пространства
│   │   │   └── SettingsPage/   # Настройки
│   │   ├── contexts/           # React Context
│   │   │   ├── AuthContext.tsx # Аутентификация
│   │   │   └── LanguageContext.tsx # Язык
│   │   ├── utils/               # Утилиты
│   │   │   ├── api.ts          # API клиент
│   │   │   ├── i18n.ts         # Переводы
│   │   │   └── icons.tsx       # Иконки
│   │   ├── types/              # TypeScript типы
│   │   │   └── index.ts
│   │   ├── styles/             # Стили
│   │   │   ├── globals.css    # Глобальные стили
│   │   │   └── variables.css   # CSS переменные
│   │   ├── App.tsx             # Главный компонент
│   │   └── main.tsx            # Точка входа
│   ├── package.json            # Зависимости
│   ├── vite.config.ts          # Конфигурация Vite
│   ├── tsconfig.json           # TypeScript конфигурация
│   └── README.md               # Документация frontend
│
├── docker-compose.yml          # Docker Compose конфигурация
├── .env                        # Переменные окружения (создать)
├── LICENSE.txt                 # Лицензия
└── README.md                   # Этот файл
```

---

## API документация

### Swagger UI

После запуска backend доступна интерактивная документация:

- **Swagger UI**: `http://localhost:8000/api/docs`
- **ReDoc**: `http://localhost:8000/api/redoc`
- **OpenAPI JSON**: `http://localhost:8000/api/openapi.json`

### Основные эндпоинты

#### Аутентификация

- `POST /api/auth/register` - Регистрация пользователя
- `POST /api/auth/login` - Вход в систему
- `POST /api/auth/refresh` - Обновление токена

#### Чат

- `POST /api/chat` - Создание нового чата
- `POST /api/chat/send` - Отправка сообщения в AI
- `GET /api/chat/history` - Получение истории чатов
- `PUT /api/chat/{chat_id}` - Обновление чата
- `DELETE /api/chat/{chat_id}` - Удаление чата

#### Пространства

- `GET /api/spaces` - Список пространств
- `POST /api/spaces` - Создание пространства
- `GET /api/spaces/{space_id}` - Получение пространства
- `PUT /api/spaces/{space_id}` - Обновление пространства
- `POST /api/spaces/{space_id}/archive` - Архивирование
- `POST /api/spaces/{space_id}/unarchive` - Разархивирование
- `GET /api/spaces/{space_id}/export` - Экспорт в ZIP

#### Заметки

- `GET /api/notes/list` - Список заметок
- `POST /api/notes/create` - Создание заметки
- `GET /api/notes/{note_id}` - Получение заметки
- `PUT /api/notes/{note_id}` - Обновление заметки
- `DELETE /api/notes/{note_id}` - Удаление заметки

#### Поиск

- `GET /api/search` - Универсальный поиск
  - Параметры: `q` (запрос), `type` (all/chats/notes/messages), `limit`

#### Поддержка

- `POST /api/support/feedback` - Отправка обратной связи
- `GET /api/support/articles` - Список статей поддержки

Подробная документация доступна в Swagger UI.

---

## ML модуль

Проект включает модуль машинного обучения для автоматической классификации бизнес-вопросов.

### Возможности

- Классификация вопросов по 6 категориям
- Обучение на датасете из 600 примеров
- Извлечение признаков из текста
- Интеграция с основным приложением

### Категории

1. **marketing** - Маркетинг, реклама, продвижение
2. **finance** - Финансы, бюджет, налоги
3. **legal** - Юриспруденция, договоры, правовые вопросы
4. **management** - Управление, команда, процессы
5. **sales** - Продажи, клиенты, сделки
6. **general** - Общие бизнес-вопросы

### Обучение модели

```bash
cd backend/ml
python train_classifier.py
```

Подробная документация: `backend/ml/Readme.md`

---

## Разработка

### Добавление новых функций

1. **Backend**: Добавьте роуты в `backend/app/routes/`
2. **Frontend**: Создайте компоненты в `frontend/src/components/`
3. **База данных**: Обновите модели в `backend/app/models/`
4. **Миграции**: Используйте Alembic для миграций БД

### Тестирование

```bash
# Backend тесты (если есть)
cd backend
pytest

# Frontend тесты (если есть)
cd frontend
npm test
```

### Линтинг

```bash
# Frontend
cd frontend
npm run lint

# Backend (если настроен)
cd backend
flake8 .
black .
```

---

## Производственное развертывание

### Рекомендации

1. **Переменные окружения**: Используйте секреты для production
2. **База данных**: Настройте резервное копирование
3. **SSL**: Настройте HTTPS через reverse proxy (nginx/Caddy)
4. **Мониторинг**: Добавьте логирование и мониторинг
5. **Масштабирование**: Используйте load balancer для нескольких инстансов

### Docker Compose для production

Создайте `docker-compose.prod.yml` с настройками для production:

```yaml
version: '3.8'

services:
  app:
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/dbname
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
    restart: always
    # Добавьте health checks, limits и т.д.
```

---

## Известные ограничения

1. **ML модель**: Только русский язык, 6 фиксированных категорий
2. **OpenRouter**: Требуется API ключ для работы AI
3. **База данных**: PostgreSQL обязательна
4. **Браузеры**: Современные браузеры с поддержкой ES6+

---

## Будущие улучшения

- [ ] Поддержка мультиязычности в ML модели
- [ ] Веб-сокеты для real-time обновлений
- [ ] Расширенная аналитика и метрики
- [ ] Интеграция с векторными БД для семантического поиска
- [ ] Мобильное приложение
- [ ] Расширенные настройки уведомлений
- [ ] Экспорт данных в различные форматы
- [ ] API для сторонних интеграций

---

## Лицензия

См. файл [LICENSE.txt](LICENSE.txt)

---

## Поддержка

При возникновении проблем:

1. Проверьте логи контейнеров: `docker compose logs`
2. Убедитесь, что все переменные окружения установлены
3. Проверьте подключение к базе данных
4. Убедитесь, что порты не заняты другими приложениями
5. Проверьте документацию API: `http://localhost:8000/api/docs`

---

**Версия:** 1.0.0  
**Последнее обновление:** 2025  
**Проект для:** Альфа-Будущее Хакатон
